<!DOCTYPE html>
<html lang="">
  <head>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="google-site-verification" content="skhepgnAG24cr-ctc2IP4LZrldG8Tpq9vdmo7oJeUcA" />
<meta name="baidu-site-verification" content="X6SobJmsrZ" />

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="description" content="Objective-C runtime 常用api及示例"/>




  <meta name="keywords" content="Runtime,Objective-C," />




  <link rel="alternate" href="/atom.xml" title="Phoenix">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.4.x" />



<link rel="canonical" href="http://yoursite.com/2017/09/17/Objective-C-runtime-常用api及示例/"/>


<meta name="description" content="列举一些常用的运行时api. 本文Demo Demo类代码Cat.h 1234567891011121314@protocol Cute@optional- (void)isCute;@end@protocol Movable@optional- (void)run;@end@interface Cat : NSObject&amp;lt;Movable&amp;gt;@property (nonatomic,">
<meta name="keywords" content="Runtime,Objective-C">
<meta property="og:type" content="article">
<meta property="og:title" content="Objective-C runtime 常用api及示例">
<meta property="og:url" content="http://yoursite.com/2017/09/17/Objective-C-runtime-常用api及示例/index.html">
<meta property="og:site_name" content="Phoenix">
<meta property="og:description" content="列举一些常用的运行时api. 本文Demo Demo类代码Cat.h 1234567891011121314@protocol Cute@optional- (void)isCute;@end@protocol Movable@optional- (void)run;@end@interface Cat : NSObject&amp;lt;Movable&amp;gt;@property (nonatomic,">
<meta property="og:updated_time" content="2018-03-07T14:52:51.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Objective-C runtime 常用api及示例">
<meta name="twitter:description" content="列举一些常用的运行时api. 本文Demo Demo类代码Cat.h 1234567891011121314@protocol Cute@optional- (void)isCute;@end@protocol Movable@optional- (void)run;@end@interface Cat : NSObject&amp;lt;Movable&amp;gt;@property (nonatomic,">


<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.4.x" />







<script>
  var CONFIG = {
    search: true,
    searchPath: "/search.xml",
    fancybox: false,
    toc: true,
  }
</script>




  



    <title> Objective-C runtime 常用api及示例 · Phoenix </title>
  </head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">Phoenix</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
      <a href="/">
        <li class="mobile-menu-item">
          
          
            Home
          
        </li>
      </a>
    
      <a href="/archives/">
        <li class="mobile-menu-item">
          
          
            Archives
          
        </li>
      </a>
    
  </ul>
</nav>

    <div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">Phoenix</a>
</div>

<nav class="site-navbar">
  
    <ul id="menu" class="menu">
      
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            
            
              Home
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            
            
              Archives
            
          </a>
        </li>
      
      
        <li class="menu-search">
          <form>
            <i class="iconfont icon-search" id="open-search"></i>
            <input type="text" class="search-input" id="search-input" />
            <i class="iconfont icon-close" id="close-search"></i>
          </form>
        </li>
      
    </ul>
  
</nav>

      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          Objective-C runtime 常用api及示例
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          Sep 17, 2017
        </span>
      </div>
    </header>

    
    
  <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">Contents</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Demo类代码"><span class="toc-text">Demo类代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Runtime-Demo"><span class="toc-text">Runtime Demo</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#class部分"><span class="toc-text">class部分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#object部分"><span class="toc-text">object部分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#动态创建一个类"><span class="toc-text">动态创建一个类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#替换方法"><span class="toc-text">替换方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#方法部分"><span class="toc-text">方法部分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#交换方法"><span class="toc-text">交换方法</span></a></li></ol></li></ol>
    </div>
  </div>


    <div class="post-content">
      
        <script src="/assets/js/DPlayer.min.js"> </script><p>列举一些常用的运行时api. <a href="https://github.com/Asura19/RuntimeDemo" target="_blank" rel="external">本文Demo</a></p>
<h2 id="Demo类代码"><a href="#Demo类代码" class="headerlink" title="Demo类代码"></a>Demo类代码</h2><p>Cat.h</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">@protocol Cute</div><div class="line">@optional</div><div class="line">- (void)isCute;</div><div class="line">@end</div><div class="line"></div><div class="line">@protocol Movable</div><div class="line">@optional</div><div class="line">- (void)run;</div><div class="line">@end</div><div class="line"></div><div class="line">@interface Cat : NSObject&lt;Movable&gt;</div><div class="line">@property (nonatomic, copy) NSString *name;</div><div class="line">- (void)mew;</div><div class="line">@end</div></pre></td></tr></table></figure>
<p>Cat.m</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line">@implementation Cat &#123;</div><div class="line">    NSColor *_color;</div><div class="line">&#125;</div><div class="line"></div><div class="line">+ (void)mews &#123;</div><div class="line">    NSLog(@&quot;+++++喵+++++&quot;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (instancetype)init &#123;</div><div class="line">    self = [super init];</div><div class="line">    if (self) &#123;</div><div class="line">        _color = [NSColor blackColor];</div><div class="line">    &#125;</div><div class="line">    return self;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)mew &#123;</div><div class="line">    NSLog(@&quot;-----喵-----&quot;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)run &#123;</div><div class="line">    NSLog(@&quot;~~run~~&quot;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (NSArray *)method0:(NSArray *)agu0</div><div class="line">                agu1:(CGFloat)agu1</div><div class="line">                agu2:(NSObject *)agu2</div><div class="line">                agu3:(NSString *)agu3</div><div class="line">                agu4:(CGRect)agu4 &#123;</div><div class="line">    </div><div class="line">    NSLog(@&quot;test method&quot;);</div><div class="line">    return @[];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)method0 &#123;</div><div class="line">    NSLog(@&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;0:%s&quot;, __func__);</div><div class="line">&#125;</div><div class="line">- (void)method1 &#123;</div><div class="line">    NSLog(@&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;1:%s&quot;, __func__);</div><div class="line">&#125;</div><div class="line">- (void)method2 &#123;</div><div class="line">    NSLog(@&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;2:%s&quot;, __func__);</div><div class="line">&#125;</div><div class="line">+ (void)catClassMethod &#123;</div><div class="line">    NSLog(@&quot;~~cat class method~~&quot;);</div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure>
<p>Cat+YYAdd.h</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">@interface Cat (YYAdd)</div><div class="line">@property (nonatomic, assign) float weight;</div><div class="line">- (void)jump;</div><div class="line">@end</div></pre></td></tr></table></figure>
<p>Cat+YYAdd.m</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">@implementation Cat (YYAdd)</div><div class="line"></div><div class="line">- (void)setWeight:(float)weight &#123;</div><div class="line">    objc_setAssociatedObject(self, @selector(weight), @(weight), OBJC_ASSOCIATION_ASSIGN);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (float)weight &#123;</div><div class="line">    return [objc_getAssociatedObject(self, _cmd) floatValue];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)jump &#123;</div><div class="line">    NSLog(@&quot;~~Cat jump~~&quot;);</div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure>
<h2 id="Runtime-Demo"><a href="#Runtime-Demo" class="headerlink" title="Runtime Demo"></a>Runtime Demo</h2><h3 id="class部分"><a href="#class部分" class="headerlink" title="class部分"></a>class部分</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div></pre></td><td class="code"><pre><div class="line">// 获取类名</div><div class="line">const char *className = class_getName(Cat.class);</div><div class="line">NSLog(@&quot;%@&quot;, [NSString stringWithUTF8String:className]);</div><div class="line">// 结果: Cat</div><div class="line"></div><div class="line">// 获取父类</div><div class="line">Class superClass = class_getSuperclass(Cat.class);</div><div class="line">NSLog(@&quot;%@&quot;, superClass);</div><div class="line">// 结果: NSObject</div><div class="line"></div><div class="line">// 该函数的作用是获取类的实例所占用内存的大小</div><div class="line">size_t instanceSizeOfClass = class_getInstanceSize(Cat.class);</div><div class="line">NSLog(@&quot;%zu&quot;, instanceSizeOfClass);</div><div class="line">// 结果: 24</div><div class="line"></div><div class="line">// 获取实例变量</div><div class="line">Ivar ivar = class_getInstanceVariable(Cat.class, &quot;_color&quot;);</div><div class="line">NSLog(@&quot;%@&quot;, [NSString stringWithUTF8String:ivar_getName(ivar)]);</div><div class="line">// 结果: _color</div><div class="line">    </div><div class="line">// 获取属性</div><div class="line">objc_property_t prop = class_getProperty(Cat.class, &quot;name&quot;);</div><div class="line">NSLog(@&quot;%@&quot;, [NSString stringWithUTF8String:property_getName(prop)]);</div><div class="line">// 结果: name</div><div class="line"></div><div class="line">// 获取实例方法的实现, 并执行</div><div class="line">IMP mewImp = class_getMethodImplementation(Cat.class, @selector(mew));</div><div class="line">mewImp();</div><div class="line">// 结果: -----喵-----</div><div class="line"></div><div class="line">// 获取类的所有实例</div><div class="line">unsigned int ivarListCount = 0;</div><div class="line">Ivar *ivars = class_copyIvarList(Cat.class, &amp;ivarListCount);</div><div class="line">for (NSInteger i = 0; i &lt; ivarListCount; i++) &#123;</div><div class="line">   Ivar ivar = ivars[i];</div><div class="line">   const char *name = ivar_getName(ivar);</div><div class="line">   NSLog(@&quot;ivarList: %@&quot;, [NSString stringWithUTF8String:name]);</div><div class="line">&#125;</div><div class="line">free(ivars);</div><div class="line">// 结果: </div><div class="line">ivarList: _color</div><div class="line">ivarList: _name</div><div class="line"></div><div class="line">// 获取类的所有属性</div><div class="line">unsigned int propertyListCount = 0;</div><div class="line">objc_property_t *props = class_copyPropertyList(Cat.class, &amp;propertyListCount);</div><div class="line">for (NSInteger i = 0; i &lt; propertyListCount; i++) &#123;</div><div class="line">   objc_property_t property = props[i];</div><div class="line">   const char *name = property_getName(property);</div><div class="line">   NSLog(@&quot;propertyList: %@&quot;, [NSString stringWithUTF8String:name]);</div><div class="line">&#125;</div><div class="line">free(props);</div><div class="line">// 结果: </div><div class="line">propertyList: weight</div><div class="line">propertyList: name</div><div class="line">// 由此可见, 运行时添加的关联属性, 没有生成实例</div><div class="line"></div><div class="line">// 获取类的所有实例方法</div><div class="line">unsigned int methodListCount = 0;</div><div class="line">Method *methods = class_copyMethodList(Cat.class, &amp;methodListCount);</div><div class="line">for (NSInteger i = 0; i &lt; methodListCount; i++) &#123;</div><div class="line">   Method method = methods[i];</div><div class="line">   SEL name = method_getName(method);</div><div class="line">   NSLog(@&quot;methodList: %@&quot;, NSStringFromSelector(name));</div><div class="line">&#125;</div><div class="line">free(methods);</div><div class="line">// 结果: </div><div class="line">methodList: mew</div><div class="line">methodList: method0:agu1:agu2:agu3:agu4:</div><div class="line">methodList: method0</div><div class="line">methodList: method1</div><div class="line">methodList: method2</div><div class="line">methodList: init</div><div class="line">methodList: .cxx_destruct</div><div class="line">methodList: name</div><div class="line">methodList: setName:</div><div class="line">methodList: run</div><div class="line">methodList: jump</div><div class="line">methodList: setWeight:</div><div class="line">methodList: weight</div><div class="line"></div><div class="line">// 获取类所遵守的协议</div><div class="line">unsigned int protocolListCount = 0;</div><div class="line">Protocol * __unsafe_unretained *protocols = class_copyProtocolList(Cat.class, &amp;protocolListCount);</div><div class="line">for (NSInteger i = 0; i &lt; protocolListCount; i++) &#123;</div><div class="line">   Protocol *protocal = protocols[i];</div><div class="line">   const char *name = protocol_getName(protocal);</div><div class="line">   NSLog(@&quot;protocolList: %@&quot;, [NSString stringWithUTF8String:name]);</div><div class="line">&#125;</div><div class="line">free(protocols);</div><div class="line">// 结果: protocolList: Movable</div><div class="line">    </div><div class="line">// 获取类的某个类方法</div><div class="line">Method classMethod = class_getClassMethod(Cat.class, NSSelectorFromString(@&quot;catClassMethod&quot;));</div><div class="line">SEL classMethodName = method_getName(classMethod);</div><div class="line">NSLog(@&quot;clasMethod: %@&quot;, NSStringFromSelector(classMethodName));</div><div class="line">IMP classMethodNameIMP = method_getImplementation(classMethod);</div><div class="line">classMethodNameIMP();</div><div class="line">// 结果: clasMethod: catClassMethod</div><div class="line"></div><div class="line">// 获取类的元类</div><div class="line">Class metaClass = objc_getMetaClass(&quot;Cat&quot;);</div><div class="line">NSLog(@&quot;meta class: %@&quot;, metaClass);</div><div class="line">// 结果: meta class: Cat</div><div class="line">    </div><div class="line">// 从元类中获取所有类方法</div><div class="line">unsigned int metaMethodListCount = 0;</div><div class="line">Method *metaMethods = class_copyMethodList(metaClass, &amp;metaMethodListCount);</div><div class="line">for (NSInteger i = 0; i &lt; metaMethodListCount; i++) &#123;</div><div class="line">   Method method = metaMethods[i];</div><div class="line">   SEL name = method_getName(method);</div><div class="line">   NSLog(@&quot;metaMethodList: %@&quot;, NSStringFromSelector(name));</div><div class="line">&#125;</div><div class="line">free(metaMethods);</div><div class="line">// 结果: </div><div class="line">metaMethodList: mews</div><div class="line">metaMethodList: catClassMethod</div><div class="line">// 证明类方法的确存放在元类中</div></pre></td></tr></table></figure>
<h3 id="object部分"><a href="#object部分" class="headerlink" title="object部分"></a>object部分</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">Cat *cat = Cat.new;</div><div class="line">cat.name = @&quot;小麻烦&quot;;</div><div class="line">cat.weight = 5.0;</div><div class="line">    </div><div class="line">NSLog(@&quot;cat weight: %@&quot;, @(cat.weight)); // cat weight: 5</div><div class="line">objc_removeAssociatedObjects(cat);</div><div class="line">NSLog(@&quot;cat weight after remove: %@&quot;, @(cat.weight)); // cat weight after remove: 0</div><div class="line">    </div><div class="line">Ivar ivar = class_getInstanceVariable(Cat.class, &quot;_color&quot;);</div><div class="line">NSLog(@&quot;internal instance old value: %@&quot;, object_getIvar(cat, ivar)); // internal instance old value: Generic Gray Gamma 2.2 Profile colorspace 0 1</div><div class="line">object_setIvar(cat, ivar, [NSColor orangeColor]);</div><div class="line">NSLog(@&quot;internal instance new value: %@&quot;, object_getIvar(cat, ivar)); // internal instance new value: sRGB IEC61966-2.1 colorspace 1 0.5 0 1</div></pre></td></tr></table></figure>
<h3 id="动态创建一个类"><a href="#动态创建一个类" class="headerlink" title="动态创建一个类"></a>动态创建一个类</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div></pre></td><td class="code"><pre><div class="line">// C语言实现得getter</div><div class="line">NSString *personNameGetter(id classInstance, SEL _cmd) &#123;</div><div class="line">    Ivar ivar = class_getInstanceVariable([classInstance class], &quot;_name&quot;);</div><div class="line">    return object_getIvar(classInstance, ivar);</div><div class="line">&#125;</div><div class="line">// C语言实现得setter</div><div class="line">void personNameSetter(id classInstance, SEL _cmd, NSString *newName) &#123;</div><div class="line">    Ivar ivar = class_getInstanceVariable([classInstance class], &quot;_name&quot;);</div><div class="line">    id oldName = object_getIvar(classInstance, ivar);</div><div class="line">    if (oldName != newName) object_setIvar(classInstance, ivar, [newName copy]);</div><div class="line">&#125;</div><div class="line"></div><div class="line">//下面对应的编码值可以在官方文档里面找到</div><div class="line">    //编码值     含意</div><div class="line">    //c     代表char类型</div><div class="line">    //i     代表int类型</div><div class="line">    //s     代表short类型</div><div class="line">    //l     代表long类型，在64位处理器上也是按照32位处理</div><div class="line">    //q     代表long long类型</div><div class="line">    //C     代表unsigned char类型</div><div class="line">    //I     代表unsigned int类型</div><div class="line">    //S     代表unsigned short类型</div><div class="line">    //L     代表unsigned long类型</div><div class="line">    //Q     代表unsigned long long类型</div><div class="line">    //f     代表float类型</div><div class="line">    //d     代表double类型</div><div class="line">    //B     代表C++中的bool或者C99中的_Bool</div><div class="line">    //v     代表void类型</div><div class="line">    //*     代表char *类型</div><div class="line">    //@     代表对象类型</div><div class="line">    //#     代表类对象 (Class)</div><div class="line">    //:     代表方法selector (SEL)</div><div class="line">    //[array type]     代表array</div><div class="line">    //&#123;name=type…&#125;     代表结构体</div><div class="line">    //(name=type…)     代表union</div><div class="line">    //bnum     A bit field of num bits</div><div class="line">    //^type     A pointer to type</div><div class="line">    //?     An unknown type (among other things, this code is used for function pointers)</div><div class="line">    </div><div class="line">    Class PersonClass = objc_allocateClassPair(NSObject.class, &quot;Person&quot;, 0);</div><div class="line">    // 添加属性必须在objc_allocateClassPair和objc_registerClassPair之间</div><div class="line">    BOOL result = class_addIvar(PersonClass,</div><div class="line">                                &quot;_gender&quot;,</div><div class="line">                                sizeof(NSString *),</div><div class="line">                                log2(sizeof(NSString *)),</div><div class="line">                                &quot;@&quot;);</div><div class="line">    </div><div class="line">    BOOL result2 = class_addIvar(PersonClass,</div><div class="line">                                &quot;_name&quot;,</div><div class="line">                                sizeof(NSString *),</div><div class="line">                                log2(sizeof(NSString *)),</div><div class="line">                                &quot;@&quot;);</div><div class="line">    </div><div class="line">    if (result &amp;&amp; result2) &#123;</div><div class="line">        objc_registerClassPair(PersonClass);</div><div class="line">    &#125;</div><div class="line">    else &#123;</div><div class="line">        objc_disposeClassPair(PersonClass);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    // https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Articles/ocrtPropertyIntrospection.html</div><div class="line">    // 结合文档, 添加属性需以T开头, V结尾</div><div class="line">    objc_property_attribute_t type = &#123;&quot;T&quot;, &quot;@\&quot;NSString\&quot;&quot;&#125;;</div><div class="line">    objc_property_attribute_t ownership = &#123;&quot;C&quot;, &quot;&quot;&#125;;</div><div class="line">    objc_property_attribute_t nonatomic = &#123;&quot;N&quot;, &quot;&quot;&#125;;</div><div class="line">    objc_property_attribute_t backingIvar = &#123;&quot;V&quot;, &quot;_name&quot;&#125;;</div><div class="line">    objc_property_attribute_t attrs[] = &#123;type, ownership, nonatomic, backingIvar&#125;;</div><div class="line">    class_addProperty(PersonClass, &quot;name&quot;, attrs, 4);</div><div class="line">    </div><div class="line">    SEL getter = NSSelectorFromString(@&quot;name&quot;);</div><div class="line">    SEL setter = NSSelectorFromString(@&quot;setName:&quot;);</div><div class="line">    // 添加方法</div><div class="line">    class_addMethod(PersonClass, getter, (IMP)personNameGetter, &quot;@@:&quot;); // or use method_getTypeEncoding for last argument</div><div class="line">    class_addMethod(PersonClass, setter, (IMP)personNameSetter, &quot;v@:@&quot;);</div><div class="line">    </div><div class="line"></div><div class="line">// 以下为测试该类</div><div class="line">    Ivar ivar = class_getInstanceVariable(PersonClass, &quot;_gender&quot;);</div><div class="line">    NSLog(@&quot;Person ivar:%@&quot;,[NSString stringWithUTF8String:ivar_getName(ivar)]);</div><div class="line">    // 结果: Person ivar:_gender</div><div class="line">    </div><div class="line">    </div><div class="line">    objc_property_t prop = class_getProperty(PersonClass, &quot;name&quot;);</div><div class="line">    NSLog(@&quot;Person property:%@&quot;,[NSString stringWithUTF8String:property_getName(prop)]);</div><div class="line">    // 结果: Person property:name</div><div class="line">    </div><div class="line">    </div><div class="line">    Method method = class_getInstanceMethod(PersonClass, NSSelectorFromString(@&quot;setName:&quot;));</div><div class="line">    NSLog(@&quot;%@&quot;, NSStringFromSelector(method_getName(method)));</div><div class="line">    // 结果: setName:</div><div class="line">    </div><div class="line">    id person = [PersonClass new];</div><div class="line">#pragma clang diagnostic push</div><div class="line">#pragma clang diagnostic ignored &quot;-Warc-performSelector-leaks&quot;</div><div class="line">    [person performSelector:setter withObject:@&quot;Phoenix&quot;];</div><div class="line">    NSLog(@&quot;person name get:%@&quot;, [person performSelector:getter withObject:nil]);</div><div class="line">#pragma clang diagnostic pop</div><div class="line">// 结果: person name get:Phoenix</div></pre></td></tr></table></figure>
<h3 id="替换方法"><a href="#替换方法" class="headerlink" title="替换方法"></a>替换方法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">void newCatMethod() &#123;</div><div class="line">    NSLog(@&quot;~~汪~~&quot;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">void replaceMethod() &#123;</div><div class="line">    class_replaceMethod(Cat.class, @selector(mew), (IMP)newCatMethod, NULL);</div><div class="line">    IMP mew = class_getMethodImplementation(Cat.class, @selector(mew));</div><div class="line">    mew();</div><div class="line">    // 结果: ~~汪~~</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="方法部分"><a href="#方法部分" class="headerlink" title="方法部分"></a>方法部分</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">#pragma clang diagnostic push</div><div class="line">#pragma clang diagnostic ignored &quot;-Wundeclared-selector&quot;</div><div class="line">    Method method = class_getInstanceMethod(Cat.class, @selector(method0:agu1:agu2:agu3:agu4:));</div><div class="line">#pragma clang diagnostic pop</div><div class="line">    </div><div class="line">    SEL methodName = method_getName(method);</div><div class="line">    NSLog(@&quot;%@&quot;, NSStringFromSelector(methodName));</div><div class="line">    // 结果: method0:agu1:agu2:agu3:agu4:</div><div class="line">    </div><div class="line">    IMP methodIMP = method_getImplementation(method);</div><div class="line">#pragma unused(methodIMP)</div><div class="line">    </div><div class="line">    const char *attrs = method_getTypeEncoding(method);</div><div class="line">    NSLog(@&quot;%@&quot;, [NSString stringWithUTF8String:attrs]);</div><div class="line">    // 结果: @80@0:8@16d24@32@40&#123;CGRect=&#123;CGPoint=dd&#125;&#123;CGSize=dd&#125;&#125;48</div><div class="line">    </div><div class="line">    unsigned int count = method_getNumberOfArguments(method);</div><div class="line">    NSLog(@&quot;%u&quot;, count);</div><div class="line">    // 结果: 7 因为还有self 和 _cmd</div><div class="line">    </div><div class="line">    for (unsigned int i =0 ; i &lt; count; i++) &#123;</div><div class="line">        char result[1024] = &#123;&#125;;</div><div class="line">        method_getArgumentType(method, i, result, 1024);</div><div class="line">        NSLog(@&quot;类型是 %s&quot;, result);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    char returnType[1024] = &#123;&#125;;</div><div class="line">    method_getReturnType(method, returnType, 1024);</div><div class="line">    NSLog(@&quot;return type:%s&quot;,returnType);</div><div class="line">    </div><div class="line">    struct objc_method_description result7 = *method_getDescription(method);</div><div class="line">    NSLog(@&quot;description ~%@ ~%@&quot;,NSStringFromSelector(result7.name),[NSString stringWithUTF8String:result7.types]);</div></pre></td></tr></table></figure>
<h3 id="交换方法"><a href="#交换方法" class="headerlink" title="交换方法"></a>交换方法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">#pragma clang diagnostic push</div><div class="line">#pragma clang diagnostic ignored &quot;-Wundeclared-selector&quot;</div><div class="line">    Method result0 = class_getInstanceMethod(Cat.class, @selector(method0));</div><div class="line">    Method result1 = class_getInstanceMethod(Cat.class, @selector(method1));</div><div class="line">    Method result2 = class_getInstanceMethod(Cat.class, @selector(method2));</div><div class="line">    method_setImplementation(result0, method_getImplementation(result1));</div><div class="line">    </div><div class="line">    method_getImplementation(result0)();</div><div class="line">    </div><div class="line">    method_exchangeImplementations(result0, result2);</div><div class="line">    </div><div class="line">    method_getImplementation(result0)();</div><div class="line">    method_getImplementation(result2)();</div><div class="line">#pragma clang diagnostic pop</div><div class="line"></div><div class="line">// 结果:  </div><div class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;1:-[Cat method1]</div><div class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;2:-[Cat method2]</div><div class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;1:-[Cat method1]</div></pre></td></tr></table></figure>

      
    </div>

    
      
      



      
      
  <div class="post-reward">
    <input type="checkbox" name="reward" id="reward" hidden />
    <label class="reward-button" for="reward">赞赏支持</label>
    <div class="qr-code">
      
      
        <label class="qr-code-image" for="reward">
          <img class="image" src="/image/reward/wechat.png" title="wechat">
        </label>
      
      
        <label class="qr-code-image" for="reward">
          <img class="image" src="/image/reward/alipay.png" title="alipay">
        </label>
      
    </div>
  </div>

    

    
      <footer class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/Runtime/">Runtime</a>
            
              <a href="/tags/Objective-C/">Objective-C</a>
            
          </div>
        
        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2018/01/11/Hexo-使用教程/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">Hexo 使用教程</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    
    
      <a class="next" href="/2017/06/06/新浪微博OnePassword-SSO登录/">
        <span class="next-text nav-default">新浪微博OnePassword SSO登录</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    
  </nav>

      </footer>
    

  </article>


          </div>
          
  <div class="comments" id="comments">
    
  </div>


        </div>  
      </main>

      <footer id="footer" class="footer">

  <div class="social-links">
    
      
        
          <a href="mailto:x.rhythm@qq.com" class="iconfont icon-email" title="email"></a>
        
      
    
      
    
      
        
          <a href="https://twitter.com/phoenixnirvana7" class="iconfont icon-twitter" title="twitter"></a>
        
      
    
      
    
      
    
      
    
      
        
          <a href="https://github.com/Asura19" class="iconfont icon-github" title="github"></a>
        
      
    
      
        
          <a href="http://weibo.com/phoenix19" class="iconfont icon-weibo" title="weibo"></a>
        
      
    
      
    
      
    
    
    
  </div>


<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://hexo.io/">Hexo</a>
  </span>
  
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">
    
    &copy; 
     
      2015 - 
    
    2018

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">John Doe</span>
  </span>
</div>
      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    
  

  
  




    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  

  


    <script type="text/javascript" src="/js/src/even.js?v=2.4.x"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=2.4.x"></script>

    
  <script type="text/html" id="search-result">
    <article class="post">
      <header class="post-header">
        <h1 class="post-title">
          <a href="$url$" class="post-link">
            $title$
          </a>
        </h1>
      </header>
      <div class="post-content">
        $content$
        <div class="read-more">
          <a href="$url$" class="read-more-link">
            Read more..
          </a>
        </div>
      </div>
    </article>
  </script>
  <script type="text/html" id="no-search-result">
    <div class="no-result">
      <h2>No result found!</h2>
    </div>
  </script>
  <script type="text/javascript" src="/js/src/search.js?v=2.4.x"></script>

  </body>
</html>
